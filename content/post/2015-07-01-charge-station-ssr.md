---
date: "2015-07-01T22:02:45+09:00"
title: "研究報告書 Charge Station"
categories:
  - "作品紹介"
tags:
  - "PIC"
  - "Charge Station"
  - "ロボット技術研究会"
thumbnail: "icon.jpg"
---

これは東京工業大学ロボット技術研究会平成27年度後期研究報告書に投稿された文書です．

## Charge Station とは

Charge Station は，自作の携帯電話充電器です．僕が命名しました．昨年（2014年）の秋ごろに初代Charge Station を作り始め，今ではVer.6となっています．主な機能は，充電完了後の給電停止と，充電電流の計測です．夜寝るときなど，携帯電話を充電器につないだまま長時間放置することに抵抗があったため，自動で給電を止める装置を自作することにしました．

 また，昨夏に100Wのソーラーパネルを購入し，100W級ソーラーシステムを自作しました．Charge Station はその電力をもとに動作します．限られた電気を有効に使うためにCharge Stationをつくりました．

<!--more-->

## Charge Station の歴史

### Charge Station Ver.1　(2014.10)

下図がCharge Staion Ver.1です．18pinのPIC16F1827を使用し，ユニバーサル基板で作りました．電計が充電対象のローサイドにあるため，USBコネクタのGNDが共通化されるとそれぞれの充電ポートを個別に，電流を測ることができないという重大な不具合を抱えています．

{{< postfig src="CS1-1.jpg" title="Charge Station Ver.1外観" width="360px" >}}
{{< postfig src="CS1-2.jpg" title="Charge Station Ver.1内部" width="360px" >}}

### Charge Station Ver.2　(2014.12)

Charge Statin Ver.2では，Ver.1の欠陥回路を修正して，切削のプリント基板に起こしました．欠陥を修復するのは容易ではありませんでした．オペアンプを1から勉強して，差動増幅回路により解決しています．Ver.2は基板のみの製作です．

{{< postfig src="CS2-1.jpg" title="Charge Station Ver.2基板" width="360px" >}}

### Charge Station Ver.3　(2015.1)

Charge Statin Ver.3では，プラスチックケースに組み込むために基板を小型化しました．また，シリアル通信によるデータ出力機能が付きました．3番目の図のようにドットマトリクスLEDを使って文字スクロール表示器も作ってみました．

{{< postfig src="CS3-1.jpg" title="Charge Station Ver.3外観" width="360px" >}}

{{< postfig src="CS3-2.jpg" title="Charge Station Ver.3内部" width="360px" >}}

{{< postfig src="CS3-3.jpg" title="Charge Station Ver.3と表示器" width="360px" >}}

### Charge Station Ver.3.5　(2015.2)

Charge Statin Ver.3.5では，Charge Statin Ver.3に液晶を付け加えました．それにより，充電電流などをいつでも確認することができます．

{{< postfig src="CS3-4.jpg" title="Charge Station Ver.3.5外観" width="360px" >}}

### Charge Station Ver.4　(2015.2)

Charge Statin Ver.4では，実用のため，コンパクトな別のプラスチックケース用に設計しました．Ver.3となかみは変わりません．

{{< postfig src="CS4-1.jpg" title="Charge Station Ver.4外観" width="360px" >}}

### Charge Station Ver.5　(2015.3)

Charge Statin Ver.5では，人生初のプリント基板発注に挑戦しました．Elecrowという，プリント基板を受注生産をしている会社があります．基板製作$10＋送料$20くらいで作ってくれます．日本円では3500円くらいでした．ユニバーサル基板や切削基板と違い，発注のプリント基板は，両面基板なので，とてもコンパクトに作ることができます．表面実装部品も，手ではんだ付けします．

{{< postfig src="CS5-1.jpg" title="Charge Station Ver.5外観" width="360px" >}}

{{< postfig src="CS5-2.jpg" title="Charge Station Ver.5プリント基板" width="360px" >}}

{{< postfig src="CS5-3.jpg" title="Charge Station Ver.5表面実装部品のはんだ付け" width="360px" >}}

### Charge Station Ver.6　(2015.6)

Charge Statin Ver.6からはメインマイコンを変更しました．28pinのPIC18F27J53という前に比べてかなりスペックの高いものに変わっています．このマイコンには，RTCC（リアルタイムクロック&カレンダー）機能が備わっていて，時計が組み込まれています．これを使って，充電時間のカウント機能をつけました．また，CTMU(Charge Time Measurement Unit)という，静電容量センサがついているので，ユーザーインターフェースのボタンをすべてタッチスイッチにしました．

{{< postfig src="CS6-1.jpg" title="Charge Station Ver.6外観" width="360px" >}}

{{< postfig src="CS6-2.jpg" title="Charge Station Ver.6内部" width="360px" >}}

{{< postfig src="CS6-3.jpg" title="Charge Station Ver.6内部" width="360px" >}}

## Charge Station Ver.6の機能

ここでは，最新バージョンの機能を紹介します．

### 自動給電オフ

100mA以下の状態が6秒以上続いた場合，充電が完了したものと解釈して，給電を停止します．

### タッチセンサ

各ポートには充電開始用のタッチセンサが設置してあります．携帯を充電するときには，触れるだけで充電を開始します．また，長押しによって，各機能を使うこともできます．センサはChargeStation表面についている銀色の板です．静電容量タッチセンサなので，スマホのタッチ画面とほぼ同じ仕組みで動いています．指との間にビニールなどを挟んだ状態でも反応します．

### 電流表示

各ポートのタッチセンサにタップすると，そのポートの充電電流がリアルタイムで表示されます．

{{< postfig src="CS6-4.jpg" title="Charge Station Ver.6電流表示" width="360px" >}}

### 積算電流表示

各ポートのタッチセンサをもう一度タップすると，今度は充電を始めてからの積算電流を表示します．

{{< postfig src="CS6-5.jpg" title="Charge Station Ver.6積算電流表示" width="360px" >}}

### 積算充電時間表示

各ポートのタッチセンサをさらにタップすると，今度は充電を始めてからの積算充電時間を表示します．

{{< postfig src="CS6-6.jpg" title="Charge Station Ver.6積算充電時間表示" width="360px" >}}

### 時計表示&時計合わせ

本体横にもタッチセンサが１つあり，それにタップすると時計が表示されます．さらに，長押しすると時計合わせモードになります．この状態で各ポートのタッチセンサをタップすることで時計を合わせることができます．

### 積算リセット機能

各ポートのタッチセンサを長押しすると「Integrat Reset?」と表示されます．この状態で指を離すと，積算電流と積算充電時間がリセット（ゼロクリア）されます．指を離さずに放置すると表示が切り替わり，リセットされません．

{{< postfig src="CS6-7.jpg" title="Charge Station Ver.6積算充電時間表示" width="360px" >}}

### 連続給電モード

少ない電流しか流れない機器に給電すると，充電が完了したとみなされて，給電が止まってしまいます．そんなときは，各ポートのタッチスイッチを積算リセットよりもさらに長押しして，自動給電停止をオフにすることで，常に電源を供給することができます．

{{< postfig src="CS6-8.jpg" title="Charge Station Ver.6自動給電停止トグル" width="360px" >}}

### LEDインジケーター

各ポートにはLEDがついています．タッチセンサに触ると接触確認のために光ります．また，充電中は，充電電流に合わせて点滅します．点滅回数×0.1Aが充電電流です．例えば10回点滅していた場合は，１．０Aの電流が流れていることがわかります．ただ，寝ているときなどにこのLEDの点滅が邪魔な時もあります．そんなときは，各ポートのタッチセンサを長押しして，「LED OFF」を選びます．こうすると，LEDは消灯します．

{{< postfig src="CS6-9.jpg" title="Charge Station Ver.6　LED点灯トグル" width="360px" >}}

### USBシリアルインターフェース

本体のわきにはミニUSBコネクタがついています．パソコンとケーブルをつなぐとシリアル通信をすることができます．シリアル通信により，充電電流や積算電流などのデータを取り出せるほか，時刻合わせ，各種設定変更ができます．

## 今後の展望

### グラフィック液晶の採用

今使っている液晶は，キャラクタ液晶と言って，アルファベットや半角カタカナの文字列しか映し出せない液晶です．キャラクタ液晶以外に，グラフィック液晶というものがあります．こちらは，ドットの画素が無数にあるので，イラストや日本語なども表示できます．次のバージョンでは，グラフィック液晶を採用し，日本語のインターフェースを実現したいです．また，充電状況を表すグラフも描けたらいいと思います．

### USBブートローダの追加

Charge Stationの内部のファームウェアを書き換えるには，直接基板にプログラミングライターを接続しなくてはなりません．しかし，プログラミングライターがいつもそばにあるとは限りません．PICマイコンにはUSBブートローダという機能があり，一度ライターを使ってプログラムを書き込んでしまえば，2回目からはUSBケーブルをつなぐだけで，ファームウェアを書きかえることができます．その機能は，意外と複雑で，今まで避けてきました．今後，実装したいです．

### 商品化

このCharge Stationの機能をもっと強化して，将来，商品化したいと思っています．現在，僕の家では，リビングに設置されていて，家族が携帯の充電に使用しています．実際に使用すると，不具合や欲しい機能などが見えてきます．改良を重ねて，みんなが買いたいと思うものを作れるように頑張りたいです．

## 謝辞

最後になりましたが，この研究をサポートしてくださった先輩方や同級生のみなさん，実際に使って感想をくれた家族に深く感謝いたします．

