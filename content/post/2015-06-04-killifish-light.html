---
date: "2015-06-04"
title: "メダカの照明の自作"
categories:
- "作品紹介"
tags:
- "めだか"
- "PIC"
- "PIC18F27J53"
- "ターミナル"
- "シリアル通信"
thumbnail: "icon.jpg"
---
こんにちは。<br />
けり(@kerikun11)です。<br />
みなさん、進捗いかがですか？<br />
僕は、ぼちぼちです。<br />
<br />
今回紹介するのは、<br />
<span style="color: rgb(0, 0, 255); font-size: x-large;">メダカの水槽の照明</span>です。<br />
<br />
高校時代の親友の刺激を受け、<br />
5月ごろからメダカを飼い始めました。<br />
生き物を飼うと、実に癒されます〜<br />
<a title="メダカ" href="fish1.jpg" target="_blank"><img class="pict" alt="メダカ" src="fish1.jpg" border="0"
    hspace="5"></a><br />
<br />
水槽には水草があるので、<br />
程よく光を当てなければなりません。<br />
普通のLEDライトで照らしてもよいのですが、<br />
ここはロ技研民として、自分で照明を作ることにしました。<br />
<br />
ところで、皆さんが帰宅する時間は何時ごろですか？<br />
帰宅するころには暗くなってますよね？<br />
朝、家を出るときに照明をつけて置くと、帰ってきても点きっぱなしです。<br />
それでは、メダカの時間感覚が狂ってしまい、かわいそう…<br />
ということで、<span style="color: rgb(0, 0, 255); font-size: large;">マイコンで明るさを自動制御</span>することにします。<br />
<br />
さらに、こんなことで電気を無駄使いしていると、親に叱られるので、<br />
電力源はソーラーにします。<br />
<span style="color: rgb(0, 0, 255); font-size: large;">とても運がいいことに、</span>僕の家には<a title="自作の１００Ｗ級ソーラーシステム"
  href="/posts/2014-09-14-solar-system/" target="_blank">自作の１００Ｗ級ソーラーシステム</a>（←リンク）があります。<br />
これを電力源に使います。<br />
<a title="100Wソーラーパネル" href="solar.jpg" target="_blank"><img class="pict" alt="solar.jpg" src="solar.jpg" border="0"
    hspace="5"><br />
</a><br />
メダカのことを英語でkillifishと言います。<br />
なので、今回の工作の名前は<span style="color: rgb(0, 0, 255); font-size: large;"> killifish light</span>としました。<br />
<br />
<span style="font-size: medium;">killifish light の<span style="color: rgb(255, 0, 0);">ポイント</span>は<br />
  1．時間に合わせて明るさが自動で変わる。<br />
  2．ソーラーを電力源にする。<br />
  3．電子工作を楽しむ。<br />
</span><br />
です。<br />
<br />
マイコンは、いつも使っているPICマイコンにしました。<br />
PIC18F27J53です。↓秋月URL<br />
<a title="PIC18F27J53" href="http://akizukidenshi.com/catalog/g/gI-05847/"
  target="_blank">http://akizukidenshi.com/catalog/g/gI-05847/<br />
</a>このPICはPICの中でもかなりハイスペックです。内蔵モジュールも多く、とても便利に使えます。<br />
そのなかでも、今回の目玉は、<span style="color: rgb(255, 0, 0);">RTCC（リアルタイムクロック&amp;カレンダー）</span>モジュールです。<br />
クロックを取り付けるだけで自動で時計のカウントをしてくれます。<br />
これをもとに、水槽の照明の明るさを制御します。<br />
<br />
LEDは秋月電子のパワーLEDを使いました。<br />
<a title="1WパワーLED" href="Power_LED.jpg" target="_blank"><img class="pict" alt="I-07750" src="Power_LED.jpg" border="0"
    hspace="5"><br />
</a>常用の1W白色パワーLEDを12個と<br />
装飾用として赤、緑、青の1WパワーLEDをそれそれ6個ずつ用意しました。<br />
LEDは全部で30個です！LED好きにはたまらないですね！<br />
<br />
それらを放熱用のアルミ板にのせて、LEDを取り付けました。<br />
けっこう熱が出ます(汗<br />
<a title="LED" href="LED.jpg" target="_blank"><img class="pict" alt="IMG_0562" src="LED.jpg" border="0"
    hspace="5"></a><br />
<a title="LED" href="under.jpg" target="_blank"><img class="pict" alt="IMG_0563" src="under.jpg" border="0"
    hspace="5"><br />
</a><br />
次に基板を作ります。<br />
今回はユニバーサル基板で作りました。<br />
部品も少ないので2時間くらいでできました。こんな感じです。<br />
<br />
<a title="基板" href="main_board.jpg" target="_blank"><img class="pict" alt="基板" src="main_board.jpg" border="0"
    hspace="5"><br />
</a><br />
写真左が電源ケーブル、右がLEDのケーブルです。<br />
上の青くて丸いものは半固定抵抗です。つまみを回して明るさを変える機能も付けました。<br />
右下のコネクタは、シリアル通信UARTの端子です。PCと接続できます。<br />
<br />
<a title="PC" href="with_PC.jpg" target="_blank"><img class="pict" alt="PC" src="with_PC.jpg" border="0"
    hspace="5"></a><br />
<br />
今回は、<span style="color: rgb(0, 0, 255); font-size: large;">ソフトウェア</span>も気合を入れて作りました！<br />
シリアル通信UARTによってPCから様々な機能を設定できるようにしました。<br />
<a title="接続" href="upper.jpg" target="_blank"><img class="pict" alt="transfer.jpg" src="upper.jpg" border="0"
    hspace="5"><br />
  <br />
</a>USB⇔シリアル変換器<br />
<a title="USBシリアル変換器" href="transfer.jpg" target="_blank"><img class="pict" alt="IMG_0570" src="transfer.jpg" border="0"
    hspace="5"></a><br />
<br />
ターミナルを操作しているようなイメージです。<br />
コマンドを入力してENTERを押すと、レスポンスが返ってきます。<br />
PC側ではTera Termでシリアル通信をします。<br />
まず、PCで「help」と入力するとメニューが現れます。<br />
<a title="help2" href="tera/help2.png" target="_blank"><img class="pict" alt="help2" src="tera/help2.png" border="0"
    hspace="5"><br />
</a><br />
メニューにあるように「t」と入力すると現在時刻が表示されます。<a title="adc" href="http://livedoor.blogimg.jp/rogyweb314/imgs/6/c/6cd173a2.png"
  target="_blank"><br />
</a><a title="t" href="tera/t.png" target="_blank"><img class="pict" alt="t" src="tera/t.png" border="0"
    hspace="5"><br />
</a><br />
「adjust_the_time(at)」コマンドを用いて時計合わせをします。<br />
「at y 15」と入力すると、年が2015年になります。<br />
<a title="aty" href="tera/aty.png" target="_blank"><img class="pict" alt="aty" src="tera/aty.png" border="0"
    hspace="5"><br />
  <br />
</a>同様に「at M 6」と入力すると、月が6月になります。<br />
続けて、日、時、分、秒を設定して、時計合わせ完了です。<a title="atM" href="tera/ats.png" target="_blank"><br />
</a><a title="ats" href="tera/ats.png" target="_blank"><img class="pict" alt="ats" src="tera/ats.png" border="0"
    hspace="5"></a><br />
<br />
一度設定してしまえば、もう設定はいりません。<br />
見てわかるように、曜日も表示されます。<br />
<br />
「set sync」と入力すると、<span style="color: rgb(0, 0, 255); font-size: large;">時間同期モード</span>になり、<br />
昼間は明るく、夕方には徐々に暗くなり、夜は消灯というように、<br />
<span style="font-size: medium;">照明を自動制御</span>をしてくれます。<br />
<a title="setsync" href="tera/setsync.png" target="_blank"><img class="pict" alt="setsync" src="tera/setsync.png"
    border="0" hspace="5"><br />
</a><br />
こんな感じです。<br />
<a title="水槽" href="white.jpg" target="_blank"><img class="pict" alt="white.jpg" src="white.jpg" border="0"
    hspace="5"></a><br />
<br />
ここまでで、一応、目的の機能はできました。<br />
<br />
<br />
ここからは、<span style="color: rgb(0, 0, 255); font-size: large;">フルカラーLED</span>で遊びます(^0^)/<br />
白色LEDのほかに光の三原色のLEDも付けたので、それを使います。<br />
シリアル通信でコマンドを送るとその通りに色が変わります〜<br />
<br />
まずは、「pwm clear」コマンドで全部のLEDを消灯します。<br />
<a title="pwmclear" href="tera/pwmclear.png" target="_blank"><img class="pict" alt="pwmclear" src="tera/pwmclear.png"
    border="0" hspace="5"></a><br />
<a title="IMG_0571" href="black.jpg" target="_blank"><img class="pict" alt="black.jpg" src="black.jpg" border="0"
    hspace="5"></a><br />
<br />
次に「pwm R 100」などと、色とパーセンテージを入力するとその明るさで光ります。<br />
<a title="pwmr" href="tera/pwmr.png" target="_blank"><img class="pict" alt="pwmr" src="tera/pwmr.png" border="0"
    hspace="5"></a><br />
<a title="赤" href="red.jpg" target="_blank"><img class="pict" alt="赤" src="red.jpg" border="0" hspace="5"><br />
</a><br />
<br />
緑色<br />
<a title="pwmg" href="tera/pwmg.png" target="_blank"><img class="pict" alt="pwmg" src="tera/pwmg.png" border="0"
    hspace="5"></a><br />
<a title="img_0579" href="greesn.jpg" target="_blank"><img class="pict" alt="緑" src="green.jpg" border="0"
    hspace="5"></a><br />
<br />
<br />
青色<br />
<a title="pwmb" href="tera/pwmb.png" target="_blank"><img class="pict" alt="pwmb" src="tera/pwmb.png" border="0"
    hspace="5"></a><br />
<a title="img_0580" href="blue.jpg" target="_blank"><img class="pict" alt="青" src="blue.jpg" border="0"
    hspace="5"></a><br />
<br />
<br />
赤＋青＝マゼンタ<br />
<a title="pwmrb" href="tera/pwmrb.png" target="_blank"><img class="pict" alt="pwmrb" src="tera/pwmrb.png" border="0"
    hspace="5"></a><br />
<a title="マゼンタ" href="magenta.jpg" target="_blank"><img class="pict" alt="マゼンタ" src="magenta.jpg" border="0"
    hspace="5"></a><br />
<br />
<br />
赤＋緑＝イエロー<br />
<a title="pwmrg" href="tera/pwmrg.png" target="_blank"><img class="pict" alt="pwmrg" src="tera/pwmrg.png" border="0"
    hspace="5"><br />
</a><a title="イエロー" href="yellow.jpg" target="_blank"><img class="pict" alt="イエロー" src="yellow.jpg" border="0"
    hspace="5"></a><br />
<br />
<br />
緑＋青＝シアン<br />
<a title="pwmgb" href="tera/pwmgb.png" target="_blank"><img class="pict" alt="pwmgb" src="tera/pwmgb.png" border="0"
    hspace="5"></a><br />
<a title="シアン" href="syan.jpg" target="_blank"><img class="pict" alt="シアン" src="syan.jpg" border="0"
    hspace="5"></a><br />
<br />
<br />
最後に全色をつけてみました。<br />
写真ではなんだか赤っぽいですが、直接目で見るとけっこういい感じです。<br />
<a title="pwmrgb" href="tera/pwmrgb.png" target="_blank"><img class="pict" alt="pwmrgb" src="tera/pwmrgb.png" border="0"
    hspace="5"></a><br />
</a><a title="白" href="RGB.jpg" target="_blank"><img class="pict" alt="RGB.jpg" src="RGB.jpg" border="0"
    hspace="5"></a><br />
<br />
<br />
pcがなくても基板の上の半固定抵抗を回すことで明るさを細かく変えることができます。<br />
また、タクトスイッチで時間同期の設定やledのオンオフ設定ができます。<br />
<a title="基板" href="main_board.jpg" target="_blank"><img class="pict" alt="基板" src="main_board.jpg" border="0"
    hspace="5"></a><br />
<br />
<br />
<br />
まとめ<br />
メダカの照明というのをきっかけに、電子工作を繰り広げました。作っていてとても楽しいですw<br />
しかも、これはソーラーの電力で動いているので、どれだけledを光らせても電気代は0円です！！<br />
これほど素晴らしいことはほかにありますかね？？<br />
電子工作ってなんでこんなに楽しいんだろう！<br />
メダカちゃんたちも元気いっぱいです！！<br />
<a title="メダカ" href="fish2.jpg" target="_blank"><img class="pict" alt="メダカ" src="fish2.jpg" border="0"
    hspace="5"></a><br />
<br />